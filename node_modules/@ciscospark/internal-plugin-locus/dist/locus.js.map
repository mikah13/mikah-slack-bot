{"version":3,"sources":["locus.js"],"names":["USE_INCOMING","USE_CURRENT","EQUAL","FETCH","Locus","extend","namespace","alert","locus","request","method","uri","url","body","deviceUrl","spark","internal","device","then","res","create","invitee","options","correlationId","Error","service","resource","localMedias","localSdp","type","sdp","list","loci","get","join","leave","self","catch","reason","Conflict","reject","decline","updateMedia","audioMuted","videoMuted","mediaId","compare","current","incoming","getEntriesFirstValue","sequence","entries","length","getEntriesLastValue","getCompareFirstValue","rangeStart","getCompareLastValue","rangeEnd","inRange","entry","currentOnlyEntries","incomingOnlyEntries","currentOnly","incomingOnly","i","push","getCallHistory","from","Date","now","toISOString","qs"],"mappings":"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","file":"locus.js","sourcesContent":["/**!\n *\n * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {SparkPlugin, SparkHttpError} from '@ciscospark/spark-core';\nimport {difference, first, last, memoize} from 'lodash';\n\nexport const USE_INCOMING = `USE_INCOMING`;\nexport const USE_CURRENT = `USE_CURRENT`;\nexport const EQUAL = `EQUAL`;\nexport const FETCH = `FETCH`;\n\nconst Locus = SparkPlugin.extend({\n  namespace: `Locus`,\n\n  /**\n   * Alert the specified locus that the local user has been notified of the\n   * locus's active state\n   * @param {Types~Locus} locus\n   * @returns {Promise}\n   */\n  alert(locus) {\n    return this.request({\n      method: `PUT`,\n      uri: `${locus.url}/participant/alert`,\n      body: {\n        deviceUrl: this.spark.internal.device.url\n      }\n    })\n      .then((res) => res.body);\n  },\n\n  /**\n   * Calls the specified invitee and offers the specified media via\n   * options.localSdp\n   * @param {string} invitee\n   * @param {Object} options\n   * @param {Object} options.localSdp\n   * @returns {Promise<Types~Locus>}\n   */\n  create(invitee, options) {\n    options = options || {};\n    const {correlationId} = options;\n\n    if (!correlationId) {\n      throw new Error(`options.correlationId is required`);\n    }\n\n    return this.request({\n      method: `POST`,\n      service: `locus`,\n      resource: `loci/call`,\n      body: {\n        correlationId,\n        deviceUrl: this.spark.internal.device.url,\n        invitee: {\n          invitee\n        },\n        localMedias: [{\n          localSdp: JSON.stringify({\n            type: `SDP`,\n            sdp: options.localSdp\n          })\n        }]\n      }\n    })\n      // res.body.mediaConnections is deprecated so just return the locus\n      .then((res) => res.body.locus);\n  },\n\n  /**\n   * Lists active loci\n   * @returns {Promise<Array<Types~Locus>>}\n   */\n  list() {\n    return this.request({\n      method: `GET`,\n      service: `locus`,\n      resource: `loci`\n    })\n      .then((res) => res.body.loci);\n  },\n\n  /**\n   * Retrieves a single Locus\n   * @param {Types~Locus} locus\n   * @returns {Types~Locus}\n   */\n  get(locus) {\n    return this.request({\n      method: `GET`,\n      uri: `${locus.url}`\n    })\n      .then((res) => res.body);\n  },\n\n  /**\n   * Join the specified Locus and offer to send it media\n   * @param {Types~Locus} locus\n   * @param {Object} options\n   * @param {Object} options.localSdp\n   * @returns {Types~Locus}\n   */\n  join(locus, options) {\n    options = options || {};\n\n    const correlationId = locus.correlationId || options.correlationId;\n\n    if (!correlationId) {\n      throw new Error(`locus.correlationId or options.correlationId is required`);\n    }\n\n    return this.request({\n      method: `POST`,\n      uri: `${locus.url}/participant`,\n      body: {\n        correlationId,\n        deviceUrl: this.spark.internal.device.url,\n        localMedias: [{\n          localSdp: JSON.stringify({\n            type: `SDP`,\n            sdp: options.localSdp\n          })\n        }]\n      }\n    })\n      // The mediaConnections object is deprecated, so just return the locus\n      .then((res) => res.body.locus);\n  },\n\n\n  /**\n   * Leave the specified Locus\n   * @param {Types~Locus} locus\n   * @returns {Promise<Types~Locus>}\n   */\n  leave(locus) {\n    return this.request({\n      method: `PUT`,\n      uri: `${locus.self.url}/leave`,\n      body: {\n        deviceUrl: this.spark.internal.device.url\n      }\n    })\n      .then((res) => res.body.locus)\n      .catch((reason) => {\n        if (reason instanceof SparkHttpError.Conflict) {\n          return this.get(locus);\n        }\n        return Promise.reject(reason);\n      });\n  },\n\n  /**\n   * Decline to join the specified Locus\n   * @param {Types~Locus} locus\n   * @returns {Promise<Types~Locus>}\n   */\n  decline(locus) {\n    return this.request({\n      method: `PUT`,\n      uri: `${locus.url}/participant/decline`,\n      body: {\n        deviceUrl: this.spark.internal.device.url\n      }\n    })\n      .then((res) => res.body)\n      .catch((reason) => {\n        if (reason instanceof SparkHttpError.Conflict) {\n          return this.get(locus);\n        }\n        return Promise.reject(reason);\n      });\n  },\n\n  /**\n   * Send a new sdp to Linus via the Locus API to update media state (e.g. to\n   * start or stop sending audio or video)\n   * @param {Types~Locus} locus\n   * @param {Object} options\n   * @param {string} options.localSdp\n   * @param {string} options.mediaId\n   * @param {Boolean} options.audioMuted\n   * @param {Boolean} options.videoMuted\n   * @returns {Promise<Types~Locus>}\n   */\n  updateMedia(locus, {sdp, audioMuted, videoMuted, mediaId}) {\n    return this.request({\n      method: `PUT`,\n      uri: `${locus.self.url}/media`,\n      body: {\n        deviceUrl: this.spark.internal.device.url,\n        localMedias: [{\n          type: `SDP`,\n          localSdp: JSON.stringify({\n            type: `SDP`,\n            sdp,\n            audioMuted,\n            videoMuted\n          }),\n          mediaId\n        }]\n      }\n    })\n      .then((res) => res.body.locus);\n  },\n\n  /**\n   * Compares two loci to determine which one contains the most recent state\n   * @param {Types~Locus} current\n   * @param {Types~Locus} incoming\n   * @returns {string} one of USE_INCOMING, USE_CURRENT, EQUAL, or FETCH\n   */\n  compare(current, incoming) {\n    if (!current) {\n      throw new Error(`\\`current\\` is required`);\n    }\n\n    if (!incoming) {\n      throw new Error(`\\`incoming\\` is required`);\n    }\n    // complexity here is unavoidable\n    /* eslint complexity: [0] */\n    /* eslint max-statements: [0] */\n\n    // must pick one of arrow-body-style or no-confusing-arrow to disable\n    /* eslint arrow-body-style: [0] */\n\n    // after running the #compare() test suite in a loop, there doesn't seem to\n    // be any appreciable difference when used with or without memoize; since\n    // real locus sequences are likely to contain more sequence numbers than\n    // those in the test suite, I have to assume memoize can only help and the\n    // overhead of memoizing these methods is not a problem.\n\n    const getEntriesFirstValue = memoize((locus) => {\n      return locus.sequence.entries.length === 0 ? 0 : first(locus.sequence.entries);\n    });\n    const getEntriesLastValue = memoize((locus) => {\n      return locus.sequence.entries.length === 0 ? 0 : last(locus.sequence.entries);\n    });\n    const getCompareFirstValue = memoize((locus) => {\n      return locus.sequence.rangeStart || getEntriesFirstValue(locus);\n    });\n    const getCompareLastValue = memoize((locus) => {\n      return getEntriesLastValue(locus) || locus.sequence.rangeEnd;\n    });\n    /**\n     * @param {number} entry\n     * @param {Types~Locus} locus\n     * @private\n     * @returns {Boolean}\n     */\n    function inRange(entry, locus) {\n      return entry >= locus.sequence.rangeStart && entry <= locus.sequence.rangeEnd;\n    }\n\n    if (getCompareLastValue(current) < getCompareFirstValue(incoming)) {\n      return USE_INCOMING;\n    }\n\n    if (getCompareFirstValue(current) > getCompareLastValue(incoming)) {\n      return USE_CURRENT;\n    }\n\n    const currentOnlyEntries = difference(current.sequence.entries, incoming.sequence.entries);\n    const incomingOnlyEntries = difference(incoming.sequence.entries, current.sequence.entries);\n    const currentOnly = [];\n    const incomingOnly = [];\n\n    for (const i of currentOnlyEntries) {\n      if (!inRange(i, incoming)) {\n        currentOnly.push(i);\n      }\n    }\n    for (const i of incomingOnlyEntries) {\n      if (!inRange(i, current)) {\n        incomingOnly.push(i);\n      }\n    }\n\n    if (!currentOnly.length && !incomingOnly.length) {\n      if (current.sequence.rangeEnd > incoming.sequence.rangeEnd) {\n        return USE_CURRENT;\n      }\n      if (current.sequence.rangeEnd < incoming.sequence.rangeEnd) {\n        return USE_INCOMING;\n      }\n      if (current.sequence.rangeStart < incoming.sequence.rangeStart) {\n        return USE_CURRENT;\n      }\n      if (current.sequence.rangeStart > incoming.sequence.rangeStart) {\n        return USE_INCOMING;\n      }\n      return EQUAL;\n    }\n\n    if (currentOnly.length && !incomingOnly.length) {\n      return USE_CURRENT;\n    }\n\n    if (!currentOnly.length && incomingOnly.length) {\n      return USE_INCOMING;\n    }\n\n    for (const i of currentOnly) {\n      if (getCompareFirstValue(incoming) < i && i < getCompareLastValue(incoming)) {\n        return FETCH;\n      }\n    }\n\n    for (const i of incomingOnly) {\n      if (getCompareFirstValue(current) < i && i < getCompareLastValue(current)) {\n        return FETCH;\n      }\n    }\n\n    if (currentOnly[0] > incomingOnly[0]) {\n      return USE_CURRENT;\n    }\n\n    return USE_INCOMING;\n  },\n\n  getCallHistory(options) {\n    options = options || {};\n    const from = (new Date(options.from || Date.now())).toISOString();\n\n    return this.request({\n      method: `GET`,\n      service: `janus`,\n      resource: `history/userSessions`,\n      qs: {from}\n    })\n      .then((res) => res.body);\n  }\n\n});\n\nexport default Locus;\n"]}