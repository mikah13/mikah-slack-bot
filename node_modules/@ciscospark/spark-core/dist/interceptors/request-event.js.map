{"version":3,"sources":["request-event.js"],"names":["RequestEventInterceptor","options","logger","console","spark","trigger","error","warn","resolve","reason","reject","response"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA;;;;AAEA;;;IAGqBA,uB;;;;;;;;;;;;AAQnB;;;;;8BAKUC,O,EAAS;AACjB,UAAMC,SAAS,mBAAI,IAAJ,kBAA0BC,OAA1B,CAAf;AACA,UAAI;AACF,aAAKC,KAAL,CAAWC,OAAX,kBAAoCJ,OAApC;AACD,OAFD,CAGA,OAAOK,KAAP,EAAc;AACZJ,eAAOK,IAAP,4CAAuDD,KAAvD;AACD;AACD,aAAO,kBAAQE,OAAR,CAAgBP,OAAhB,CAAP;AACD;;AAED;;;;;;;;;mCAMeA,O,EAASQ,M,EAAQ;AAC9B;AACA;AACA,UAAMP,SAAS,mBAAI,IAAJ,kBAA0BC,OAA1B,CAAf;AACA,UAAI;AACF,aAAKC,KAAL,CAAWC,OAAX,gBAAkCJ,OAAlC,EAA2CQ,MAA3C;AACA,aAAKL,KAAL,CAAWC,OAAX,oBAAsCJ,OAAtC,EAA+CQ,MAA/C;AACD,OAHD,CAIA,OAAOH,KAAP,EAAc;AACZJ,eAAOK,IAAP,0CAAqDD,KAArD;AACD;AACD,aAAO,kBAAQI,MAAR,CAAeD,MAAf,CAAP;AACD;;AAED;;;;;;;;;+BAMWR,O,EAASU,Q,EAAU;AAC5B,UAAMT,SAAS,mBAAI,IAAJ,kBAA0BC,OAA1B,CAAf;AACA,UAAI;AACF,aAAKC,KAAL,CAAWC,OAAX,oBAAsCM,SAASV,OAA/C,EAAwDU,QAAxD;AACD,OAFD,CAGA,OAAOL,KAAP,EAAc;AACZJ,eAAOK,IAAP,8CAAyDD,KAAzD;AACD;AACD,aAAO,kBAAQE,OAAR,CAAgBG,QAAhB,CAAP;AACD;;AAED;;;;;;;;;oCAMgBV,O,EAASQ,M,EAAQ;AAC/B,UAAMP,SAAS,mBAAI,IAAJ,kBAA0BC,OAA1B,CAAf;AACA,UAAI;AACF,aAAKC,KAAL,CAAWC,OAAX,gBAAkCJ,OAAlC,EAA2CQ,MAA3C;AACA,aAAKL,KAAL,CAAWC,OAAX,oBAAsCJ,OAAtC,EAA+CQ,MAA/C;AACD,OAHD,CAIA,OAAOH,KAAP,EAAc;AACZJ,eAAOK,IAAP,8CAAyDD,KAAzD;AACD;AACD,aAAO,kBAAQI,MAAR,CAAeD,MAAf,CAAP;AACD;;;;AA5ED;;;6BAGgB;AACd,aAAO,IAAIT,uBAAJ,CAA4B,EAACI,OAAO,IAAR,EAA5B,CAAP;AACD;;;0BAlBH;;;;;;kBAYqBJ,uB","file":"request-event.js","sourcesContent":["/**!\n *\n * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.\n * @private\n */\n\nimport {get} from 'lodash';\nimport {Interceptor} from '@ciscospark/http-core';\n\n/**\n * @class\n */\nexport default class RequestEventInterceptor extends Interceptor {\n  /**\n   * @returns {RequestEventInterceptor}\n   */\n  static create() {\n    return new RequestEventInterceptor({spark: this});\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @returns {Object}\n   */\n  onRequest(options) {\n    const logger = get(this, `spark.logger`, console);\n    try {\n      this.spark.trigger(`request:start`, options);\n    }\n    catch (error) {\n      logger.warn(`event handler for request:start failed `, error);\n    }\n    return Promise.resolve(options);\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @param {Error} reason\n   * @returns {Object}\n   */\n  onRequestError(options, reason) {\n    // We need to do the normal onRequest logging, but then log how the request\n    // failed since the response logger won't be called.\n    const logger = get(this, `spark.logger`, console);\n    try {\n      this.spark.trigger(`request:end`, options, reason);\n      this.spark.trigger(`request:failure`, options, reason);\n    }\n    catch (error) {\n      logger.warn(`event handler for request:end failed `, error);\n    }\n    return Promise.reject(reason);\n  }\n\n  /**\n   * @see Interceptor#onResponse\n   * @param {Object} options\n   * @param {HttpResponse} response\n   * @returns {Object}\n   */\n  onResponse(options, response) {\n    const logger = get(this, `spark.logger`, console);\n    try {\n      this.spark.trigger(`request:success`, response.options, response);\n    }\n    catch (error) {\n      logger.warn(`event handler for request:success failed `, error);\n    }\n    return Promise.resolve(response);\n  }\n\n  /**\n   * @see Interceptor#onResponseError\n   * @param {Object} options\n   * @param {Error} reason\n   * @returns {Object}\n   */\n  onResponseError(options, reason) {\n    const logger = get(this, `spark.logger`, console);\n    try {\n      this.spark.trigger(`request:end`, options, reason);\n      this.spark.trigger(`request:failure`, options, reason);\n    }\n    catch (error) {\n      logger.warn(`event handler for request:failure failed `, error);\n    }\n    return Promise.reject(reason);\n  }\n\n}\n"]}